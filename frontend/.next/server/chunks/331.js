"use strict";exports.id=331,exports.ids=[331],exports.modules={7331:(e,t,s)=>{s.r(t),s.d(t,{default:()=>d});var l=s(326),a=s(7577);function r({track:e,remixes:t=[],onOpenRemix:s,onVote:r}){let[n,d]=(0,a.useState)(!1),c=async()=>{try{(await fetch(`http://localhost:3002/api/tracks/${e.id}/vote`,{method:"PATCH"})).ok&&r&&r()}catch(e){console.error("Vote error",e)}};return(0,l.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,l.jsxs)("div",{className:"flex justify-between items-start gap-4",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[l.jsx("h3",{className:"text-lg font-bold",children:e.title}),t.length>0&&(0,l.jsxs)("span",{className:"px-2 py-1 bg-purple-600 rounded-full text-xs",children:[t.length," remix",1!==t.length?"es":""]})]}),l.jsx("p",{className:"text-sm text-gray-400",children:e.description}),(0,l.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["Uploaded by: ",e.artist]}),(0,l.jsxs)("p",{className:"text-xs text-gray-500",children:["Created: ",new Date(e.createdAt).toLocaleString()]})]}),(0,l.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[t.length>0&&l.jsx("button",{onClick:()=>d(e=>!e),className:"px-3 py-1 bg-primary rounded text-sm",children:n?"Hide Remixes":"Show Remixes"}),l.jsx("button",{onClick:s,className:"px-3 py-1 bg-secondary rounded text-sm",children:"Upload Remix"})]})]}),l.jsx("div",{className:"mt-4",children:l.jsx("audio",{controls:!0,src:e.fileUrl,className:"w-full"})}),(0,l.jsxs)("div",{className:"mt-3 flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"text-sm text-primary font-bold",children:[e.voteCount||0," votes"]}),l.jsx("div",{className:"flex items-center gap-3",children:l.jsx("button",{onClick:c,className:"px-3 py-1 bg-green-600 rounded text-sm",children:"Vote"})})]}),n&&t.length>0&&(0,l.jsxs)("div",{className:"mt-4 border-t border-gray-700 pt-3",children:[(0,l.jsxs)("h4",{className:"font-bold text-purple-400 mb-3",children:["Remixes (",t.length,")"]}),t.map(e=>(0,l.jsxs)("div",{className:"mt-3 p-3 bg-gray-900 rounded border border-purple-500/30",children:[(0,l.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"font-semibold text-purple-300",children:["\uD83C\uDFB5 ",e.title]}),(0,l.jsxs)("div",{className:"text-xs text-gray-400",children:["by ",e.artist]}),l.jsx("div",{className:"text-xs text-gray-500",children:new Date(e.createdAt).toLocaleString()})]}),(0,l.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[(0,l.jsxs)("div",{className:"text-sm text-primary font-bold",children:[e.voteCount||0," votes"]}),l.jsx("button",{onClick:async()=>{try{(await fetch(`http://localhost:3002/api/tracks/${e.id}/vote`,{method:"PATCH"})).ok&&r&&r()}catch(e){console.error("Vote error",e)}},className:"px-2 py-1 bg-green-600 rounded text-xs",children:"Vote"})]})]}),l.jsx("div",{className:"mt-2",children:l.jsx("audio",{controls:!0,src:e.fileUrl,className:"w-full"})})]},e.id))]})]})}function n({parentId:e,onClose:t,onSuccess:s}){let[r,n]=(0,a.useState)(""),[d,c]=(0,a.useState)(""),[i,o]=(0,a.useState)(null),[x,m]=(0,a.useState)(!1),[p,h]=(0,a.useState)(null),u=async t=>{if(t.preventDefault(),!i)return h("Please select a file");m(!0),h(null);try{let t=new FormData;t.append("file",i),t.append("title",r),t.append("description",d),t.append("parentId",e);let l=await fetch("http://localhost:3002/api/tracks",{method:"POST",body:t});if(!l.ok){let e=await l.text();throw Error(e||"Upload failed")}let a=await l.json();s&&s(a.track)}catch(e){console.error(e),h(e.message||"Upload error")}finally{m(!1)}};return l.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-gray-900 p-6 rounded-lg w-full max-w-lg",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[l.jsx("h3",{className:"text-lg font-bold",children:"Upload Remix"}),l.jsx("button",{onClick:t,className:"text-gray-400",children:"Close"})]}),(0,l.jsxs)("form",{onSubmit:u,className:"space-y-4",children:[(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm",children:"Title"}),l.jsx("input",{value:r,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 bg-gray-800 rounded"})]}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm",children:"Description"}),l.jsx("textarea",{value:d,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 bg-gray-800 rounded",rows:3})]}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm",children:"MP4 / Audio File"}),l.jsx("input",{type:"file",accept:"video/mp4,audio/*",onChange:e=>{o(e.target.files[0])},className:"w-full"})]}),p&&l.jsx("div",{className:"text-red-400",children:p}),(0,l.jsxs)("div",{className:"flex justify-end gap-2",children:[l.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 bg-gray-700 rounded",children:"Cancel"}),l.jsx("button",{type:"submit",disabled:x,className:"px-4 py-2 bg-primary rounded",children:x?"Uploading...":"Upload"})]})]})]})})}function d(){let[e,t]=(0,a.useState)([]),[s,d]=(0,a.useState)(!0),[c,i]=(0,a.useState)(null),[o,x]=(0,a.useState)(null);async function m(){d(!0),i(null);try{let e=await fetch("http://localhost:3002/api/tracks");if(!e.ok)throw Error("Failed to load tracks");let s=(await e.json()).tracks||[];s.sort((e,t)=>new Date(t.createdAt)-new Date(e.createdAt)),t(s)}catch(e){console.error("Error fetching tracks:",e),i("Unable to load tracks")}finally{d(!1)}}let p=e.filter(e=>!e.parentId);return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,l.jsxs)("h2",{className:"text-2xl font-bold",children:["Tracks (",p.length,") - Total: ",e.length]}),l.jsx("button",{onClick:m,disabled:s,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 rounded font-bold",children:s?"⏳ Loading...":"\uD83D\uDD04 Refresh"})]}),c&&(0,l.jsxs)("div",{className:"bg-red-800/40 text-red-200 p-4 rounded mb-4",children:["Error loading tracks: ",c,l.jsx("button",{onClick:m,className:"ml-4 px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-sm",children:"Retry"})]}),!s&&!c&&e.length>0&&0===p.length&&(0,l.jsxs)("div",{className:"bg-yellow-800/40 text-yellow-200 p-4 rounded mb-4",children:[(0,l.jsxs)("p",{className:"font-bold",children:["⚠️ ",e.length," tracks loaded but all are remixes (no parent tracks)"]}),l.jsx("p",{className:"text-sm mt-2",children:"All tracks have parentId set"})]}),!s&&!c&&0===e.length&&(0,l.jsxs)("div",{className:"text-center py-12 text-gray-400",children:[l.jsx("p",{className:"text-xl mb-2",children:"No tracks yet"}),l.jsx("p",{children:"Upload a track to get started!"})]}),!s&&!c&&p.length>0&&l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.map(t=>l.jsx(r,{track:t,remixes:e.filter(e=>e.parentId===t.id),onOpenRemix:()=>x(t.id),onVote:()=>m()},t.id))}),o&&l.jsx(n,{parentId:o,onClose:()=>x(null),onSuccess:e=>{m(),x(null)}})]})}}};