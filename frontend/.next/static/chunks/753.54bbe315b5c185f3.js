"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[753],{8753:function(e,t,r){r.r(t),r.d(t,{default:function(){return d}});var s=r(7437),n=r(2265),i=r(5810),a=r(1662),l=r(4552),o=r(7870);function d(){let{signer:e,provider:t,account:r}=(0,o.O)(),[d,c]=(0,n.useState)(null),[u,x]=(0,n.useState)(null),[m,g]=(0,n.useState)(""),[b,p]=(0,n.useState)(""),[h,f]=(0,n.useState)("0"),[v,y]=(0,n.useState)(!1),[N,w]=(0,n.useState)(!1),[j,D]=(0,n.useState)(!1),[C,E]=(0,n.useState)(""),[R,S]=(0,n.useState)(0),[I,V]=(0,n.useState)([]),[k,z]=(0,n.useState)(!1),[F,A]=(0,n.useState)(!1),[T,P]=(0,n.useState)(""),[U,_]=(0,n.useState)(""),[L,O]=(0,n.useState)(!1),q="0x7637801a09823b8AF38c0029DAe381EA4c31668b",B="0x3d6aC5D3FFae950a03Ea6B14387895Ddc9E631A5",H=["function host() view returns (address)","function trackURI() view returns (string)","function prizeAmount() view returns (uint256)","function votingActive() view returns (bool)","function prizeDistributed() view returns (bool)","function winner() view returns (address)","function winningRemixId() view returns (uint256)","function remixCount() view returns (uint256)","function submitRemix(string calldata _remixURI)","function vote(uint256 _remixId)","function endVoting()","function getAllRemixes() view returns (uint256[], address[], string[], uint256[])","function hasUserVoted(address _voter) view returns (bool)","function getVotingStatus() view returns (bool, bool, address, uint256, uint256)","event RemixSubmitted(uint256 indexed remixId, address indexed remixer, string remixURI)","event VoteCast(address indexed voter, uint256 indexed remixId, uint256 newVoteCount)","event VotingEnded(uint256 indexed winningRemixId, address indexed winner, uint256 voteCount)","event PrizeDistributed(address indexed winner, uint256 amount)"],M=["function approve(address spender, uint256 amount) returns (bool)","function allowance(address owner, address spender) view returns (uint256)","function balanceOf(address account) view returns (uint256)"];async function W(e){try{let[t,s,n,i,l,o,d]=await Promise.all([e.trackURI(),e.host(),e.prizeAmount(),e.votingActive(),e.prizeDistributed(),e.winner(),e.winningRemixId()]);if(g(t),p(s),f(a.dF(n)),w(i),D(l),E(o),S(Number(d)),r){y(r.toLowerCase()===s.toLowerCase());let t=await e.hasUserVoted(r);z(t)}await Y(e)}catch(e){console.error("Load data error:",e),P("Error loading data: ".concat(e.message))}}async function Y(e){try{let[t,r,s,n]=await e.getAllRemixes(),i=t.map((e,t)=>({id:Number(e),remixer:r[t],uri:s[t],votes:Number(n[t])}));i.sort((e,t)=>t.votes-e.votes),V(i)}catch(e){console.error("Load remixes error:",e)}}async function G(){if(d&&U){A(!0);try{P("\uD83D\uDCE4 Submitting remix...");let e=await d.submitRemix(U);P("⏳ Transaction pending..."),await e.wait(),P("✅ Remix submitted successfully!"),_(""),O(!1),await Y(u)}catch(e){console.error("Submit error:",e),P("❌ Error: ".concat(e.reason||e.message))}finally{A(!1)}}}async function K(e){if(d){A(!0);try{P("\uD83D\uDDF3️ Casting vote...");let t=await d.vote(e);P("⏳ Transaction pending..."),await t.wait(),P("✅ Vote cast successfully!"),z(!0),await Y(u)}catch(e){console.error("Vote error:",e),P("❌ Error: ".concat(e.reason||e.message))}finally{A(!1)}}}async function X(){if(d){if(B)try{let t=new i.CH(B,M,e),s=await t.allowance(r,q),n=a.fi(h);if(s<n){P("⚠️ Approving prize tokens...");let e=await t.approve(q,n);P("⏳ Approval pending..."),await e.wait(),P("✅ Tokens approved!")}}catch(e){console.error("Approval error:",e),P("❌ Approval failed: ".concat(e.message));return}A(!0);try{P("\uD83C\uDFC1 Ending voting and distributing prize...");let e=await d.endVoting();P("⏳ Transaction pending..."),await e.wait(),P("✅ Voting ended! Prize distributed to winner!"),await W(u)}catch(e){console.error("End voting error:",e),P("❌ Error: ".concat(e.reason||e.message))}finally{A(!1)}}}return(0,n.useEffect)(()=>{if(!q){P("⚠️ Contract address not configured");return}if(t){let e=new i.CH(q,H,t);x(e),W(e),function(e){let t=null,s=null,n=async()=>{try{if(!e||!e.runner)return;let s=e.runner.provider,n=await s.getBlockNumber();if(null===t){t=n;return}if(n<=t)return;let i=t+1,l=Math.min(n,i+99);try{let t=e.filters.RemixSubmitted();for(let r of(await e.queryFilter(t,i,l)))Y(e),P("✅ New remix submitted!")}catch(e){console.error("RemixSubmitted query error:",e)}try{let t=e.filters.VoteCast();for(let s of(await e.queryFilter(t,i,l))){let[t,n,i]=s.args;Y(e),r&&t.toLowerCase()===r.toLowerCase()&&(z(!0),P("✅ Your vote has been recorded!"))}}catch(e){console.error("VoteCast query error:",e)}try{let t=e.filters.VotingEnded();for(let r of(await e.queryFilter(t,i,l))){let[e,t,s]=r.args;w(!1),E(t),S(Number(e)),P("\uD83C\uDFC6 Voting ended! Winner declared!")}}catch(e){console.error("VotingEnded query error:",e)}try{let t=e.filters.PrizeDistributed();for(let r of(await e.queryFilter(t,i,l))){let[e,t]=r.args;D(!0),P("\uD83D\uDCB0 Prize of ".concat(a.dF(t)," MON sent to winner!"))}}catch(e){console.error("PrizeDistributed query error:",e)}t=l}catch(e){console.error("Polling error:",e)}};s=setInterval(n,3e3),n(),()=>{s&&clearInterval(s)}}(e)}e&&c(new i.CH(q,H,e))},[t,e,r]),(0,s.jsxs)("div",{className:"max-w-6xl mx-auto p-6",children:[(0,s.jsxs)("div",{className:"bg-gradient-to-r from-purple-900 to-indigo-900 rounded-lg p-6 mb-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"\uD83C\uDFB5 Track Voting & Prize Distribution"}),(0,s.jsx)("p",{className:"text-gray-300",children:"Submit remixes, vote, and win prizes on Monad testnet"})]}),!q&&(0,s.jsx)("div",{className:"bg-red-900/50 border border-red-500 rounded-lg p-4 mb-6",children:(0,s.jsxs)("p",{className:"text-red-200",children:["⚠️ ",(0,s.jsx)("strong",{children:"TrackVoting contract not configured!"}),(0,s.jsx)("br",{}),"Please deploy the contract and add NEXT_PUBLIC_TRACK_VOTING_ADDRESS to .env.local"]})}),(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Track Details"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm text-gray-400",children:"Host"}),(0,s.jsxs)("p",{className:"font-mono text-sm",children:[b?"".concat(b.slice(0,6),"...").concat(b.slice(-4)):"Loading...",v&&(0,s.jsx)("span",{className:"ml-2 text-purple-400",children:"(You)"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm text-gray-400",children:"Prize"}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-yellow-400",children:[h," MON"]})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"text-sm text-gray-400",children:"Track URI"}),(0,s.jsx)("p",{className:"font-mono text-xs break-all text-gray-300",children:m||"Loading..."})]})]}),(0,s.jsxs)("div",{className:"mt-4 flex gap-2",children:[N?(0,s.jsx)("span",{className:"px-3 py-1 bg-green-600 rounded-full text-sm font-bold",children:"\uD83D\uDFE2 VOTING ACTIVE"}):(0,s.jsx)("span",{className:"px-3 py-1 bg-red-600 rounded-full text-sm font-bold",children:"\uD83D\uDD34 VOTING ENDED"}),j&&(0,s.jsx)("span",{className:"px-3 py-1 bg-yellow-600 rounded-full text-sm font-bold",children:"\uD83D\uDCB0 PRIZE DISTRIBUTED"})]})]}),T&&(0,s.jsx)("div",{className:"mb-6 p-4 rounded-lg ".concat(T.includes("❌")?"bg-red-900/40 text-red-200":T.includes("✅")?"bg-green-900/40 text-green-200":T.includes("⚠️")?"bg-yellow-900/40 text-yellow-200":"bg-blue-900/40 text-blue-200"),children:T}),!N&&C&&C!==l.N&&(0,s.jsxs)("div",{className:"bg-gradient-to-r from-yellow-900 to-orange-900 border-2 border-yellow-500 rounded-lg p-6 mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("span",{className:"text-4xl",children:"\uD83C\uDFC6"}),(0,s.jsx)("h2",{className:"text-2xl font-bold",children:"Winner!"})]}),(0,s.jsxs)("p",{className:"text-lg mb-2",children:["Remix #",R," by"," ",(0,s.jsxs)("span",{className:"font-mono font-bold",children:[C.slice(0,6),"...",C.slice(-4)]})]}),j&&(0,s.jsxs)("p",{className:"text-green-300",children:["✅ Prize of ",h," MON tokens distributed!"]})]}),(0,s.jsxs)("div",{className:"flex gap-3 mb-6",children:[N&&!v&&!k&&(0,s.jsx)("button",{onClick:()=>O(!L),className:"px-6 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-bold transition",children:"\uD83D\uDCE4 Submit Remix"}),N&&v&&I.length>0&&(0,s.jsx)("button",{onClick:X,disabled:F,className:"px-6 py-3 bg-red-600 hover:bg-red-700 rounded-lg font-bold transition disabled:opacity-50",children:"\uD83C\uDFC1 End Voting & Distribute Prize"})]}),L&&N&&(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-bold mb-4",children:"Submit Your Remix"}),(0,s.jsx)("input",{type:"text",value:U,onChange:e=>_(e.target.value),placeholder:"Enter remix URI (ipfs:// or http://...)",className:"w-full px-4 py-3 bg-gray-900 rounded-lg mb-3"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:G,disabled:F||!U,className:"px-6 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg font-bold transition disabled:opacity-50",children:"Submit"}),(0,s.jsx)("button",{onClick:()=>O(!1),className:"px-6 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition",children:"Cancel"})]})]}),(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,s.jsxs)("h2",{className:"text-xl font-bold mb-4",children:["Remixes (",I.length,")"]}),0===I.length?(0,s.jsx)("p",{className:"text-gray-400 text-center py-8",children:"No remixes submitted yet. Be the first!"}):(0,s.jsx)("div",{className:"space-y-3",children:I.map((e,t)=>(0,s.jsxs)("div",{className:"p-4 rounded-lg border-2 ".concat(e.id!==R||N?"border-gray-700 bg-gray-900":"border-yellow-500 bg-yellow-900/20"),children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[0===t&&(0,s.jsx)("span",{className:"text-2xl",children:"\uD83E\uDD47"}),1===t&&(0,s.jsx)("span",{className:"text-2xl",children:"\uD83E\uDD48"}),2===t&&(0,s.jsx)("span",{className:"text-2xl",children:"\uD83E\uDD49"}),(0,s.jsxs)("span",{className:"text-sm text-gray-400",children:["Remix #",e.id]}),e.id===R&&!N&&(0,s.jsx)("span",{className:"px-2 py-1 bg-yellow-600 rounded-full text-xs font-bold",children:"\uD83C\uDFC6 WINNER"})]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 font-mono mb-2",children:["by ",e.remixer.slice(0,6),"...",e.remixer.slice(-4)]}),(0,s.jsx)("p",{className:"text-xs text-gray-400 break-all",children:e.uri})]}),(0,s.jsxs)("div",{className:"text-right ml-4",children:[(0,s.jsx)("div",{className:"text-3xl font-bold text-purple-400",children:e.votes}),(0,s.jsx)("div",{className:"text-xs text-gray-400",children:"votes"})]})]}),N&&!k&&!v&&(0,s.jsx)("button",{onClick:()=>K(e.id),disabled:F,className:"w-full px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg font-bold transition disabled:opacity-50",children:"\uD83D\uDDF3️ Vote for this Remix"}),k&&(0,s.jsx)("div",{className:"text-center text-sm text-gray-500 py-2",children:"✅ You have already voted"})]},e.id))})]}),(0,s.jsxs)("div",{className:"mt-6 bg-blue-900/30 border border-blue-500 rounded-lg p-4",children:[(0,s.jsx)("h3",{className:"font-bold mb-2",children:"ℹ️ How It Works"}),(0,s.jsxs)("ul",{className:"text-sm text-blue-200 space-y-1",children:[(0,s.jsx)("li",{children:"• Submit your remix URI to enter the competition"}),(0,s.jsx)("li",{children:"• Vote for your favorite remix (one vote per wallet)"}),(0,s.jsx)("li",{children:"• Host ends voting when ready"}),(0,s.jsx)("li",{children:"• Remix with most votes wins the prize automatically"}),(0,s.jsx)("li",{children:"• Prize MON tokens sent directly to winner"})]})]})]})}}}]);