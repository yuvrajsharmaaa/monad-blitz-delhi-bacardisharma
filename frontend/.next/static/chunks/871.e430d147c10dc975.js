"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[871],{9871:function(e,t,s){s.r(t),s.d(t,{default:function(){return c}});var l=s(7437),a=s(2265);function r(e){let{track:t,remixes:s=[],onOpenRemix:r,onVote:n}=e,[c,d]=(0,a.useState)(!1),i=async()=>{try{(await fetch("http://localhost:3002/api/tracks/".concat(t.id,"/vote"),{method:"PATCH"})).ok&&n&&n()}catch(e){console.error("Vote error",e)}};return(0,l.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,l.jsxs)("div",{className:"flex justify-between items-start gap-4",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("h3",{className:"text-lg font-bold",children:t.title}),s.length>0&&(0,l.jsxs)("span",{className:"px-2 py-1 bg-purple-600 rounded-full text-xs",children:[s.length," remix",1!==s.length?"es":""]})]}),(0,l.jsx)("p",{className:"text-sm text-gray-400",children:t.description}),(0,l.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["Uploaded by: ",t.artist]}),(0,l.jsxs)("p",{className:"text-xs text-gray-500",children:["Created: ",new Date(t.createdAt).toLocaleString()]})]}),(0,l.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[s.length>0&&(0,l.jsx)("button",{onClick:()=>d(e=>!e),className:"px-3 py-1 bg-primary rounded text-sm",children:c?"Hide Remixes":"Show Remixes"}),(0,l.jsx)("button",{onClick:r,className:"px-3 py-1 bg-secondary rounded text-sm",children:"Upload Remix"})]})]}),(0,l.jsx)("div",{className:"mt-4",children:(0,l.jsx)("audio",{controls:!0,src:t.fileUrl,className:"w-full"})}),(0,l.jsxs)("div",{className:"mt-3 flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"text-sm text-primary font-bold",children:[t.voteCount||0," votes"]}),(0,l.jsx)("div",{className:"flex items-center gap-3",children:(0,l.jsx)("button",{onClick:i,className:"px-3 py-1 bg-green-600 rounded text-sm",children:"Vote"})})]}),c&&s.length>0&&(0,l.jsxs)("div",{className:"mt-4 border-t border-gray-700 pt-3",children:[(0,l.jsxs)("h4",{className:"font-bold text-purple-400 mb-3",children:["Remixes (",s.length,")"]}),s.map(e=>(0,l.jsxs)("div",{className:"mt-3 p-3 bg-gray-900 rounded border border-purple-500/30",children:[(0,l.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"font-semibold text-purple-300",children:["\uD83C\uDFB5 ",e.title]}),(0,l.jsxs)("div",{className:"text-xs text-gray-400",children:["by ",e.artist]}),(0,l.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.createdAt).toLocaleString()})]}),(0,l.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[(0,l.jsxs)("div",{className:"text-sm text-primary font-bold",children:[e.voteCount||0," votes"]}),(0,l.jsx)("button",{onClick:async()=>{try{(await fetch("http://localhost:3002/api/tracks/".concat(e.id,"/vote"),{method:"PATCH"})).ok&&n&&n()}catch(e){console.error("Vote error",e)}},className:"px-2 py-1 bg-green-600 rounded text-xs",children:"Vote"})]})]}),(0,l.jsx)("div",{className:"mt-2",children:(0,l.jsx)("audio",{controls:!0,src:e.fileUrl,className:"w-full"})})]},e.id))]})]})}function n(e){let{parentId:t,onClose:s,onSuccess:r}=e,[n,c]=(0,a.useState)(""),[d,i]=(0,a.useState)(""),[o,x]=(0,a.useState)(null),[m,h]=(0,a.useState)(!1),[p,u]=(0,a.useState)(null),g=async e=>{if(e.preventDefault(),!o)return u("Please select a file");h(!0),u(null);try{let e=new FormData;e.append("file",o),e.append("title",n),e.append("description",d),e.append("parentId",t);let s=await fetch("http://localhost:3002/api/tracks",{method:"POST",body:e});if(!s.ok){let e=await s.text();throw Error(e||"Upload failed")}let l=await s.json();r&&r(l.track)}catch(e){console.error(e),u(e.message||"Upload error")}finally{h(!1)}};return(0,l.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-gray-900 p-6 rounded-lg w-full max-w-lg",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h3",{className:"text-lg font-bold",children:"Upload Remix"}),(0,l.jsx)("button",{onClick:s,className:"text-gray-400",children:"Close"})]}),(0,l.jsxs)("form",{onSubmit:g,className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"Title"}),(0,l.jsx)("input",{value:n,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 bg-gray-800 rounded"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"Description"}),(0,l.jsx)("textarea",{value:d,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 bg-gray-800 rounded",rows:3})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"MP4 / Audio File"}),(0,l.jsx)("input",{type:"file",accept:"video/mp4,audio/*",onChange:e=>{x(e.target.files[0])},className:"w-full"})]}),p&&(0,l.jsx)("div",{className:"text-red-400",children:p}),(0,l.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,l.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 bg-gray-700 rounded",children:"Cancel"}),(0,l.jsx)("button",{type:"submit",disabled:m,className:"px-4 py-2 bg-primary rounded",children:m?"Uploading...":"Upload"})]})]})]})})}function c(){let[e,t]=(0,a.useState)([]),[s,c]=(0,a.useState)(!0),[d,i]=(0,a.useState)(null),[o,x]=(0,a.useState)(null);async function m(){c(!0),i(null);try{let e=await fetch("".concat("http://localhost:3002","/api/tracks"));if(!e.ok)throw Error("Failed to load tracks");let s=(await e.json()).tracks||[];s.sort((e,t)=>new Date(t.createdAt)-new Date(e.createdAt)),t(s)}catch(e){console.error("Error fetching tracks:",e),i("Unable to load tracks")}finally{c(!1)}}(0,a.useEffect)(()=>{m()},[]);let h=e.filter(e=>!e.parentId);return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,l.jsxs)("h2",{className:"text-2xl font-bold",children:["Tracks (",h.length,") - Total: ",e.length]}),(0,l.jsx)("button",{onClick:m,disabled:s,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 rounded font-bold",children:s?"⏳ Loading...":"\uD83D\uDD04 Refresh"})]}),d&&(0,l.jsxs)("div",{className:"bg-red-800/40 text-red-200 p-4 rounded mb-4",children:["Error loading tracks: ",d,(0,l.jsx)("button",{onClick:m,className:"ml-4 px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-sm",children:"Retry"})]}),!s&&!d&&e.length>0&&0===h.length&&(0,l.jsxs)("div",{className:"bg-yellow-800/40 text-yellow-200 p-4 rounded mb-4",children:[(0,l.jsxs)("p",{className:"font-bold",children:["⚠️ ",e.length," tracks loaded but all are remixes (no parent tracks)"]}),(0,l.jsx)("p",{className:"text-sm mt-2",children:"All tracks have parentId set"})]}),!s&&!d&&0===e.length&&(0,l.jsxs)("div",{className:"text-center py-12 text-gray-400",children:[(0,l.jsx)("p",{className:"text-xl mb-2",children:"No tracks yet"}),(0,l.jsx)("p",{children:"Upload a track to get started!"})]}),!s&&!d&&h.length>0&&(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.map(t=>(0,l.jsx)(r,{track:t,remixes:e.filter(e=>e.parentId===t.id),onOpenRemix:()=>x(t.id),onVote:()=>m()},t.id))}),o&&(0,l.jsx)(n,{parentId:o,onClose:()=>x(null),onSuccess:e=>{m(),x(null)}})]})}}}]);